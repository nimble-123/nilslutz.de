---
title: 'Modularisierung von CDS Annotations'
summary: 'Strukturierte Organisation von CDS Annotations nach Concerns fÃ¼r wartbare SAP CAP-Anwendungen.'
tags: ['CAP', 'CDS', 'Architecture', 'Best Practices']
date: '2025-12-17'
---

# Modularisierung von CDS Annotations

**CDS Annotations** sind das HerzstÃ¼ck von Fiori Elements Apps. Bei wachsender KomplexitÃ¤t wird eine strukturierte Organisation essentiell fÃ¼r die Wartbarkeit.

## Problem

In kleinen Projekten werden alle Annotations in einer Datei definiert:

```cds
// âŒ Anti-Pattern: Alles in einer Datei (annotations.cds)
using TrackService from './track-service';

annotate TrackService.TimeEntries with @(
  // UI Annotations (300 Zeilen)
  UI.LineItem: [
    {Value: workDate, Label: '{i18n>date}'},
    {Value: startTime, Label: '{i18n>start}'},
    // ...50 weitere Felder
  ],
  UI.FieldGroup #Details: { /* ... */ },
  UI.HeaderInfo: { /* ... */ },

  // Common Annotations (50 Zeilen)
  Common.Label: '{i18n>timeEntry}',
  Common.Text: workDate,

  // Capabilities (30 Zeilen)
  Capabilities.InsertRestrictions: { /* ... */ },
  Capabilities.UpdateRestrictions: { /* ... */ },

  // Value Helps (80 Zeilen)
  Common.ValueList #Project: { /* ... */ },
  Common.ValueList #EntryType: { /* ... */ },

  // Authorization (40 Zeilen)
  @restrict: [ /* ... */ ],

  // Field Controls (60 Zeilen)
  @readonly, @mandatory, @UI.Hidden

  // Analytics (30 Zeilen)
  Analytics.Measure: true,

  // Search (20 Zeilen)
  Search.defaultSearchElement: true
);

// Weitere 5 EntitÃ¤ten mit jeweils 200-500 Zeilen...
```

**Probleme:**

- âŒ 600+ Zeilen pro EntitÃ¤t
- âŒ Schwer zu navigieren (Ctrl+F nÃ¶tig)
- âŒ Merge-Konflikte hÃ¤ufig (mehrere Entwickler)
- âŒ Keine klare Trennung der Concerns
- âŒ Copy-Paste zwischen EntitÃ¤ten

## LÃ¶sung: Zwei-Ebenen-Struktur

### Strukturierter Ansatz

```
srv/track-service/annotations/
â”œâ”€â”€ annotations.cds           # Master Import
â”œâ”€â”€ common/                   # Shared Concerns
â”‚   â”œâ”€â”€ labels.cds            # @Common.Text, Titles
â”‚   â”œâ”€â”€ field-controls.cds    # @readonly, @mandatory
â”‚   â”œâ”€â”€ capabilities.cds      # Insert/Update Restrictions
â”‚   â”œâ”€â”€ value-helps.cds       # @Common.ValueList
â”‚   â”œâ”€â”€ authorization.cds     # @restrict
â”‚   â””â”€â”€ search.cds            # Search Configuration
â””â”€â”€ ui/                       # UI-Specific (Fiori Elements)
    â”œâ”€â”€ time-entries/
    â”‚   â”œâ”€â”€ list.cds          # List Report
    â”‚   â”œâ”€â”€ object.cds        # Object Page
    â”‚   â”œâ”€â”€ charts.cds        # Charts & Analytics
    â”‚   â””â”€â”€ actions.cds       # Bound Actions UI
    â”œâ”€â”€ projects/
    â”‚   â””â”€â”€ basic.cds         # Simple CRUD
    â””â”€â”€ users/
        â””â”€â”€ basic.cds         # Simple CRUD
```

### Master Import (annotations.cds)

```cds
// 1. Common Concerns (entity-Ã¼bergreifend)
using from './common/labels';
using from './common/field-controls';
using from './common/capabilities';
using from './common/value-helps';
using from './common/authorization';
using from './common/search';

// 2. UI-Specific (per entity)
using from './ui/time-entries/list';
using from './ui/time-entries/object';
using from './ui/time-entries/charts';
using from './ui/time-entries/actions';

using from './ui/projects/basic';
using from './ui/users/basic';
```

## Detaillierte Struktur

### 1. Labels (common/labels.cds)

**Zweck:** Texte, Ãœbersetzungen, Titles

```cds
using TrackService from '../../track-service';

// TimeEntries
annotate TrackService.TimeEntries with @(
  Common.Label: '{i18n>timeEntry}',
  Common.Text: workDate,
  Common.TextArrangement: #TextOnly
) {
  workDate @(
    Common.Label: '{i18n>workDate}',
    Common.Text: workDate
  );

  entryType @(
    Common.Label: '{i18n>entryType}',
    Common.Text: entryType.text,
    Common.TextArrangement: #TextFirst
  );

  project @(
    Common.Label: '{i18n>project}',
    Common.Text: project.name,
    Common.TextArrangement: #TextOnly
  );
}

// Weitere EntitÃ¤ten...
```

### 2. Field Controls (common/field-controls.cds)

**Zweck:** @readonly, @mandatory, @UI.Hidden

```cds
using TrackService from '../../track-service';

annotate TrackService.TimeEntries with {
  // Read-only Felder (berechnet)
  durationHoursGross @readonly;
  durationHoursNet   @readonly;
  overtimeHours      @readonly;
  undertimeHours     @readonly;

  // Pflichtfelder
  user      @mandatory;
  workDate  @mandatory;
  startTime @mandatory;
  endTime   @mandatory;

  // Versteckte technische Felder
  source    @UI.Hidden;
  createdAt @UI.Hidden;
  modifiedAt @UI.Hidden;
}
```

### 3. Capabilities (common/capabilities.cds)

**Zweck:** Insert/Update/Delete Restrictions

```cds
using TrackService from '../../track-service';

annotate TrackService.TimeEntries with @(
  Capabilities: {
    InsertRestrictions: {
      Insertable: true,
      RequiredProperties: [
        user_ID,
        workDate,
        startTime,
        endTime,
        entryType_code
      ]
    },
    UpdateRestrictions: {
      Updatable: true,
      NonUpdatableNavigationProperties: [user]
    },
    DeleteRestrictions: {
      Deletable: true
    },
    FilterRestrictions: {
      FilterExpressionRestrictions: [{
        Property: workDate,
        AllowedExpressions: 'MultiValue'
      }]
    }
  }
);
```

### 4. Value Helps (common/value-helps.cds)

**Zweck:** Dropdowns, F4-Hilfen

```cds
using TrackService from '../../track-service';

annotate TrackService.TimeEntries with {
  entryType @(
    Common.ValueList: {
      CollectionPath: 'EntryTypes',
      Parameters: [
        { $Type: 'Common.ValueListParameterInOut',
          LocalDataProperty: entryType_code,
          ValueListProperty: 'code' },
        { $Type: 'Common.ValueListParameterDisplayOnly',
          ValueListProperty: 'text' }
      ]
    },
    Common.ValueListWithFixedValues: true
  );

  project @(
    Common.ValueList: {
      CollectionPath: 'Projects',
      Parameters: [
        { $Type: 'Common.ValueListParameterInOut',
          LocalDataProperty: project_ID,
          ValueListProperty: 'ID' },
        { $Type: 'Common.ValueListParameterDisplayOnly',
          ValueListProperty: 'name' },
        { $Type: 'Common.ValueListParameterDisplayOnly',
          ValueListProperty: 'number' }
      ]
    },
    Common.ValueListRelevantQualifiers: ['active']
  );
}
```

### 5. UI List Report (ui/time-entries/list.cds)

**Zweck:** List Report Table Configuration

```cds
using TrackService from '../../../track-service';

annotate TrackService.TimeEntries with @(
  UI.SelectionFields: [
    user_ID,
    workDate,
    entryType_code,
    project_ID,
    status_code
  ],

  UI.LineItem: [
    { Value: workDate, Label: '{i18n>workDate}' },
    { Value: entryType.text, Label: '{i18n>type}' },
    { Value: project.name, Label: '{i18n>project}' },
    { Value: startTime, Label: '{i18n>start}' },
    { Value: endTime, Label: '{i18n>end}' },
    { Value: durationHoursNet, Label: '{i18n>netHours}',
      Criticality: netHoursCriticality },
    { Value: overtimeHours, Label: '{i18n>overtime}',
      Criticality: overtimeCriticality },
    { Value: status.name, Label: '{i18n>status}',
      Criticality: statusCriticality },
    { $Type: 'UI.DataFieldForAction',
      Action: 'TrackService.markDone',
      Label: '{i18n>markDone}' }
  ],

  UI.PresentationVariant: {
    SortOrder: [{
      Property: workDate,
      Descending: true
    }],
    Visualizations: ['@UI.LineItem']
  }
);
```

### 6. UI Object Page (ui/time-entries/object.cds)

**Zweck:** Object Page Sections & Field Groups

```cds
using TrackService from '../../../track-service';

annotate TrackService.TimeEntries with @(
  UI.HeaderInfo: {
    TypeName: '{i18n>timeEntry}',
    TypeNamePlural: '{i18n>timeEntries}',
    Title: { Value: workDate },
    Description: { Value: entryType.text }
  },

  UI.Identification: [
    { Value: workDate },
    { Value: entryType.text },
    { Value: status.name, Criticality: statusCriticality }
  ],

  UI.Facets: [
    { $Type: 'UI.ReferenceFacet',
      Label: '{i18n>generalInfo}',
      Target: '@UI.FieldGroup#General' },
    { $Type: 'UI.ReferenceFacet',
      Label: '{i18n>timeDetails}',
      Target: '@UI.FieldGroup#TimeDetails' },
    { $Type: 'UI.ReferenceFacet',
      Label: '{i18n>calculations}',
      Target: '@UI.FieldGroup#Calculations' },
    { $Type: 'UI.ReferenceFacet',
      Label: '{i18n>attachments}',
      Target: 'attachments/@UI.LineItem' }
  ],

  UI.FieldGroup #General: {
    Data: [
      { Value: user.name },
      { Value: project.name },
      { Value: activity.text },
      { Value: workLocation.text },
      { Value: travelType.text }
    ]
  },

  UI.FieldGroup #TimeDetails: {
    Data: [
      { Value: startTime },
      { Value: endTime },
      { Value: breakMin }
    ]
  },

  UI.FieldGroup #Calculations: {
    Data: [
      { Value: durationHoursGross },
      { Value: durationHoursNet },
      { Value: overtimeHours, Criticality: overtimeCriticality },
      { Value: undertimeHours, Criticality: undertimeCriticality }
    ]
  }
);
```

## Vorteile

### 1. Ãœbersichtlichkeit

```
Vorher: 1 Datei Ã— 2.500 Zeilen = âŒ unÃ¼bersichtlich
Nachher: 15 Dateien Ã— ~150 Zeilen = âœ… navigierbar
```

### 2. Klare Verantwortlichkeiten

Jede Datei hat **einen** Zweck:

- `labels.cds` â†’ Texte
- `list.cds` â†’ List Report
- `object.cds` â†’ Object Page

### 3. Paralleles Arbeiten

```
ğŸ‘¤ Developer A: Arbeitet an List Report (list.cds)
ğŸ‘¤ Developer B: Arbeitet an Object Page (object.cds)
â†’ Keine Merge-Konflikte âœ…
```

### 4. Wiederverwendung

```cds
// Shared Field Controls fÃ¼r alle EntitÃ¤ten
using from './common/field-controls';

// Spezifische UI nur wo benÃ¶tigt
using from './ui/time-entries/list';
```

## Best Practices

### 1. Naming Conventions

```
âœ… Gut: labels.cds, list.cds, object.cds
âŒ Schlecht: anno1.cds, stuff.cds, temp.cds
```

### 2. Ein Concern pro Datei

```cds
// âœ… Gut: Nur Labels
annotate TimeEntries with {
  workDate @Common.Label: '{i18n>workDate}';
}

// âŒ Schlecht: Labels + UI gemischt
annotate TimeEntries with {
  workDate @Common.Label: '{i18n>workDate}'
           @UI.LineItem;  // Falscher Concern!
}
```

### 3. Master Import

```cds
// annotations.cds als zentrale Import-Datei
using from './common/labels';
using from './common/capabilities';
using from './ui/time-entries/list';
```

### 4. Konsistente Struktur

```
Alle EntitÃ¤ten folgen gleichem Muster:
  ui/entity-name/
    â”œâ”€â”€ list.cds
    â”œâ”€â”€ object.cds
    â””â”€â”€ charts.cds (optional)
```

## Implementierung in CAPture Time

### VollstÃ¤ndige Struktur

```
srv/track-service/annotations/
â”œâ”€â”€ annotations.cds           # Master Import (20 Zeilen)
â”œâ”€â”€ common/
â”‚   â”œâ”€â”€ labels.cds            # 150 Zeilen
â”‚   â”œâ”€â”€ field-controls.cds    # 80 Zeilen
â”‚   â”œâ”€â”€ capabilities.cds      # 120 Zeilen
â”‚   â”œâ”€â”€ value-helps.cds       # 200 Zeilen
â”‚   â”œâ”€â”€ authorization.cds     # 100 Zeilen
â”‚   â””â”€â”€ search.cds            # 50 Zeilen
â””â”€â”€ ui/
    â”œâ”€â”€ time-entries/
    â”‚   â”œâ”€â”€ list.cds          # 150 Zeilen
    â”‚   â”œâ”€â”€ object.cds        # 200 Zeilen
    â”‚   â”œâ”€â”€ charts.cds        # 100 Zeilen
    â”‚   â””â”€â”€ actions.cds       # 80 Zeilen
    â”œâ”€â”€ projects/
    â”‚   â””â”€â”€ basic.cds         # 100 Zeilen
    â””â”€â”€ users/
        â””â”€â”€ basic.cds         # 80 Zeilen

Gesamt: ~1.400 Zeilen in 14 Dateien
Statt: 1.400 Zeilen in 1 Datei âŒ
```

## Alternativen

### Option 1: Monolith (1 Datei)

âŒ UnÃ¼bersichtlich ab 500+ Zeilen

### Option 2: Pro EntitÃ¤t (1 Datei pro Entity)

âš ï¸ Besser, aber immer noch groÃŸe Dateien

### Option 3: Nach Concerns (gewÃ¤hlt)

âœ… Maximale ModularitÃ¤t

## Trade-offs

**Vorteile:**

- âœ… Ãœbersichtliche Dateien (< 200 Zeilen)
- âœ… Klare Trennung der Concerns
- âœ… Paralleles Arbeiten ohne Konflikte
- âœ… Einfaches Finden von Annotations

**Nachteile:**

- âš ï¸ Mehr Dateien (14 statt 1)
- âš ï¸ Mehr Navigationsaufwand zwischen Dateien
- âš ï¸ Initialer Setup-Aufwand

## Wann modularisieren?

**âœ… Modularisieren wenn:**

- Annotations-Datei > 300 Zeilen
- Mehrere Entwickler arbeiten an UI
- Mehrere Fiori Apps (List Report, Analytical List)
- Komplexe Object Pages mit vielen Facets

**âŒ Nicht modularisieren wenn:**

- Nur 1-2 EntitÃ¤ten
- Sehr einfache CRUD-UI
- Team < 2 Entwickler
- Annotations < 200 Zeilen

## Fazit

Die **Modularisierung nach Concerns** ist essentiell fÃ¼r wartbare Fiori Elements Apps. Sie ermÃ¶glicht:

- **Ãœbersichtlichen Code** durch kleine Dateien
- **Paralleles Arbeiten** ohne Merge-Konflikte
- **Klare Verantwortlichkeiten** pro Datei
- **Einfache Navigation** durch logische Struktur

## Siehe auch

- [Fiori Elements Documentation](https://ui5.sap.com/test-resources/sap/fe/core/fpmExplorer/index.html)
- [CDS Annotations Reference](https://cap.cloud.sap/docs/advanced/odata#annotations)
- [ADR 0006: CDS Annotations](https://github.com/nimble-123/cap-fiori-timetracking/blob/main/docs/ADR/0006-modularisierung-cds-annotationen.md) im Original-Projekt
